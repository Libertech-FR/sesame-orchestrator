<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Sesame Orchestrator</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">Sesame Orchestrator</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >IdentitiesService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/management/identities/identities.service.ts</code>
        </p>



            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                            <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
            </p>


            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Abstract</span>
                                <a href="#_model" >_model</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                    <span class="modifier">Optional</span>
                                <a href="#_req" >_req</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Optional</span>
                                <a href="#eventEmitter" >eventEmitter</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#logger" >logger</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#moduleRef" >moduleRef</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#checkFingerprint" >checkFingerprint</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#checkInetOrgPersonJpegPhoto" >checkInetOrgPersonJpegPhoto</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#create" >create</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#delete" >delete</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#fusion" >fusion</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#generateFingerprint" >generateFingerprint</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#handleValidationError" >handleValidationError</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#previewFingerprint" >previewFingerprint</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#searchDoubles" >searchDoubles</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#transformNullsToString" >transformNullsToString</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#update" >update</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#updateState" >updateState</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#updateStateMany" >updateStateMany</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#upsertWithFingerprint" >upsertWithFingerprint</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#count" >count</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#find" >find</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#findAndCount" >findAndCount</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#findById" >findById</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#findOne" >findOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#upsert" >upsert</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                                <span class="modifier">Public</span>
                        <code>constructor(_model: <a href="../classes/Identities.html" target="_self">Model&lt;Identities&gt;</a>, _validation: <a href="../injectables/IdentitiesValidationService.html" target="_self">IdentitiesValidationService</a>, storage: FactorydriveService)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="29" class="link-to-prism">src/management/identities/identities.service.ts:29</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>_model</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/Identities.html" target="_self" >Model&lt;Identities&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>_validation</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/IdentitiesValidationService.html" target="_self" >IdentitiesValidationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>storage</td>
                                                  
                                                        <td>
                                                                    <code>FactorydriveService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkFingerprint"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>checkFingerprint</b></span>
                        <a href="#checkFingerprint"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkFingerprint(filters: FilterQuery<T>, fingerprint: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="212"
                                    class="link-to-prism">src/management/identities/identities.service.ts:212</a></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filters</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>fingerprint</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkInetOrgPersonJpegPhoto"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>checkInetOrgPersonJpegPhoto</b></span>
                        <a href="#checkInetOrgPersonJpegPhoto"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkInetOrgPersonJpegPhoto(data: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="306"
                                    class="link-to-prism">src/management/identities/identities.service.ts:306</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>data</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="create"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>create</b></span>
                        <a href="#create"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>create(data?: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, options?: SaveOptions)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:38</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>data</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>SaveOptions</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Document&lt;T, any, T&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="delete"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>delete</b></span>
                        <a href="#delete"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>delete(_id: Types.ObjectId | any, options?: QueryOptions<T> | null | undefined)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:201</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>_id</td>
                                            <td>
                                                        <code>Types.ObjectId | any</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Query&lt;T, T, any, T&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="fusion"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>fusion</b></span>
                        <a href="#fusion"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>fusion(id1, id2)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="443"
                                    class="link-to-prism">src/management/identities/identities.service.ts:443</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id1</td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>id2</td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="generateFingerprint"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>generateFingerprint</b></span>
                        <a href="#generateFingerprint"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>generateFingerprint(identity: <a href="../classes/Identities.html" target="_self">Identities</a>, fingerprint?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="231"
                                    class="link-to-prism">src/management/identities/identities.service.ts:231</a></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>identity</td>
                                            <td>
                                                            <code><a href="../classes/Identities.html" target="_self" >Identities</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>fingerprint</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleValidationError"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>handleValidationError</b></span>
                        <a href="#handleValidationError"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>handleValidationError(error: Error | HttpException, identity: Identities | IdentitiesUpsertDto, logPrefix: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="278"
                                    class="link-to-prism">src/management/identities/identities.service.ts:278</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>error</td>
                                            <td>
                                                        <code>Error | HttpException</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>identity</td>
                                            <td>
                                                        <code>Identities | IdentitiesUpsertDto</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>logPrefix</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="previewFingerprint"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>previewFingerprint</b></span>
                        <a href="#previewFingerprint"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>previewFingerprint(identity: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="256"
                                    class="link-to-prism">src/management/identities/identities.service.ts:256</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>identity</td>
                                            <td>
                                                            <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="searchDoubles"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>searchDoubles</b></span>
                        <a href="#searchDoubles"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>searchDoubles()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="345"
                                    class="link-to-prism">src/management/identities/identities.service.ts:345</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="transformNullsToString"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>transformNullsToString</b></span>
                        <a href="#transformNullsToString"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>transformNullsToString(obj)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="323"
                                    class="link-to-prism">src/management/identities/identities.service.ts:323</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>obj</td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="update"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>update</b></span>
                        <a href="#update"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>update(_id: Types.ObjectId | any, update: UpdateQuery<T>, options?)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:125</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>_id</td>
                                            <td>
                                                        <code>Types.ObjectId | any</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>update</td>
                                            <td>
                                                        <code>UpdateQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateState"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>updateState</b></span>
                        <a href="#updateState"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateState(_id: Types.ObjectId | any, state: <a href="../undefineds/IdentityState.html" target="_self">IdentityState</a>, options?)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="169"
                                    class="link-to-prism">src/management/identities/identities.service.ts:169</a></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>_id</td>
                                            <td>
                                                        <code>Types.ObjectId | any</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>state</td>
                                            <td>
                                                            <code><a href="../miscellaneous/enumerations.html#IdentityState" target="_self" >IdentityState</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateStateMany"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>updateStateMany</b></span>
                        <a href="#updateStateMany"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateStateMany(body: literal type)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="178"
                                    class="link-to-prism">src/management/identities/identities.service.ts:178</a></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>body</td>
                                            <td>
                                                        <code>literal type</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;ModifyResult[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="upsertWithFingerprint"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>upsertWithFingerprint</b></span>
                        <a href="#upsertWithFingerprint"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>upsertWithFingerprint(filters: FilterQuery<T>, data?: <a href="../classes/IdentitiesUpsertDto.html" target="_self">IdentitiesUpsertDto</a>, options?: QueryOptions<T>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="49"
                                    class="link-to-prism">src/management/identities/identities.service.ts:49</a></div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filters</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>data</td>
                                            <td>
                                                            <code><a href="../classes/IdentitiesUpsertDto.html" target="_self" >IdentitiesUpsertDto</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="count"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>count</b></span>
                        <a href="#count"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>count(filter?: FilterQuery<T>, options?:  | null)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:44</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code> | null</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;number&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="find"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>find</b></span>
                        <a href="#find"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>find(filter?: FilterQuery<T>, projection?: ProjectionType<T> | null | undefined, options?: QueryOptions<T> | null | undefined)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:34</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>projection</td>
                                            <td>
                                                        <code>ProjectionType&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Query[]&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findAndCount"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>findAndCount</b></span>
                        <a href="#findAndCount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findAndCount(filter?: FilterQuery<T>, projection?: ProjectionType<T> | null | undefined, options?: QueryOptions<T> | null | undefined)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:50</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>projection</td>
                                            <td>
                                                        <code>ProjectionType&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findById"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>findById</b></span>
                        <a href="#findById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findById(_id: Types.ObjectId | any, projection?: ProjectionType<T> | null | undefined, options?: QueryOptions<T> | null | undefined)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:84</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>_id</td>
                                            <td>
                                                        <code>Types.ObjectId | any</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>projection</td>
                                            <td>
                                                        <code>ProjectionType&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Query&lt;T, T, any, T&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOne"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>findOne</b></span>
                        <a href="#findOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOne(filter?: FilterQuery<T>, projection?: ProjectionType<T> | null | undefined, options?: QueryOptions<T> | null | undefined)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:118</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>projection</td>
                                            <td>
                                                        <code>ProjectionType&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt; | null | undefined</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Query&lt;T, T, any, T&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="upsert"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                        <span ><b>upsert</b></span>
                        <a href="#upsert"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>upsert(filter: FilterQuery<T>, update: UpdateQuery<T>, options?: QueryOptions<T>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:257</a></code>
</div>
                        </td>
                    </tr>

                    <tr>
                        <td class="col-md-4">
                            <b>Type parameters :</b>
                            <ul class="type-parameters">
                                    <li>T</li>
                            </ul>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>filter</td>
                                            <td>
                                                        <code>FilterQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>update</td>
                                            <td>
                                                        <code>UpdateQuery&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                        </tr>
                                        <tr>
                                                <td>options</td>
                                            <td>
                                                        <code>QueryOptions&lt;T&gt;</code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt;</code>

                        </div>
                            <div class="io-description">
                                
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_model"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Abstract</span>
                        <span ><b>_model</b></span>
                        <a href="#_model"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/AbstractSchema.html" target="_self" >Model&lt;AbstractSchema | Document&gt;</a></code>

                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../injectables/AbstractServiceSchema.html" target="_self" >AbstractServiceSchema</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractServiceSchema.html#source" target="_self" >AbstractServiceSchema:23</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_req"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                            <span class="modifier">Optional</span>
                        <span ><b>_req</b></span>
                        <a href="#_req"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../injectables/AbstractService.html" target="_self" >AbstractService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractService.html#source" target="_self" >AbstractService:19</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="eventEmitter"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Optional</span>
                        <span ><b>eventEmitter</b></span>
                        <a href="#eventEmitter"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>EventEmitter2</code>

                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../injectables/AbstractService.html" target="_self" >AbstractService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractService.html#source" target="_self" >AbstractService:20</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logger"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>logger</b></span>
                        <a href="#logger"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/Logger.html" target="_self" >Logger</a></code>

                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../injectables/AbstractService.html" target="_self" >AbstractService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractService.html#source" target="_self" >AbstractService:17</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="moduleRef"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                        <span ><b>moduleRef</b></span>
                        <a href="#moduleRef"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>ModuleRef</code>

                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../injectables/AbstractService.html" target="_self" >AbstractService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/AbstractService.html#source" target="_self" >AbstractService:18</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { BadRequestException, HttpException, HttpStatus, Injectable } from &#x27;@nestjs/common&#x27;;
import { InjectModel } from &#x27;@nestjs/mongoose&#x27;;
import {
  Document,
  FilterQuery,
  Model,
  ModifyResult,
  Query,
  QueryOptions,
  SaveOptions,
  Types,
  UpdateQuery,
} from &#x27;mongoose&#x27;;
import { createHash } from &#x27;node:crypto&#x27;;
import { construct, omit, unique } from &#x27;radash&#x27;;
import { AbstractServiceSchema } from &#x27;~/_common/abstracts/abstract.service.schema&#x27;;
import { AbstractSchema } from &#x27;~/_common/abstracts/schemas/abstract.schema&#x27;;
import { ValidationConfigException, ValidationSchemaException } from &#x27;~/_common/errors/ValidationException&#x27;;
import { toPlainAndCrush } from &#x27;~/_common/functions/to-plain-and-crush&#x27;;
import { IdentitiesUpsertDto } from &#x27;./_dto/identities.dto&#x27;;
import { IdentityState } from &#x27;./_enums/states.enum&#x27;;
import { Identities } from &#x27;./_schemas/identities.schema&#x27;;
import { IdentitiesValidationService } from &#x27;./validations/identities.validation.service&#x27;;
import { FactorydriveService } from &#x27;@the-software-compagny/nestjs_module_factorydrive&#x27;;
import { ApiBadRequestResponse } from &quot;@nestjs/swagger&quot;;
import { InitStatesEnum } from &quot;~/management/identities/_enums/init-state.enum&quot;;

@Injectable()
export class IdentitiesService extends AbstractServiceSchema {
  public constructor(
    @InjectModel(Identities.name) protected _model: Model&lt;Identities&gt;,
    protected readonly _validation: IdentitiesValidationService,
    protected readonly storage: FactorydriveService,
  ) {
    super();
  }

  public async create&lt;T extends AbstractSchema | Document&gt;(
    data?: any,
    options?: SaveOptions,
  ): Promise&lt;Document&lt;T, any, T&gt;&gt; {
    data &#x3D; this.transformNullsToString(data);
    await this.checkInetOrgPersonJpegPhoto(data);
    const created: Document&lt;T, any, T&gt; &#x3D; await super.create(data, options);
    return created;
    //TODO: add backends service logic here
  }

  public async upsertWithFingerprint&lt;T extends AbstractSchema | Document&gt;(
    filters: FilterQuery&lt;T&gt;,
    data?: IdentitiesUpsertDto,
    options?: QueryOptions&lt;T&gt;,
  ): Promise&lt;[HttpStatus.OK | HttpStatus.CREATED, ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;]&gt; {
    data &#x3D; this.transformNullsToString(data);
    const identity &#x3D; await this.model.findOne(filters).exec();
    this.logger.log(&#x60;Upserting identity with filters ${JSON.stringify(filters)}&#x60;);

    const crushedUpdate &#x3D; toPlainAndCrush(omit(data || {}, [&#x27;$setOnInsert&#x27;]));
    const crushedSetOnInsert &#x3D; toPlainAndCrush(data.$setOnInsert || {});
    data &#x3D; construct({
      ...crushedSetOnInsert,
      ...toPlainAndCrush(identity?.toJSON() || {}, {
        excludePrefixes: [&#x27;_id&#x27;, &#x27;fingerprint&#x27;],
      }),
      ...crushedUpdate,
      &#x27;additionalFields.objectClasses&#x27;: unique([
        ...(data.additionalFields?.objectClasses || []),
        ...((identity as any)?.additionalFields?.objectClasses || []),
      ]),
    });

    // console.log(&#x27;data&#x27;, data);

    if (!data?.inetOrgPerson?.employeeNumber || !data?.inetOrgPerson?.employeeType) {
      throw new BadRequestException(
        &#x27;inetOrgPerson.employeeNumber and inetOrgPerson.employeeType are required for create identity.&#x27;,
      );
    }

    await this.checkInetOrgPersonJpegPhoto(data);

    const logPrefix &#x3D; &#x60;Validation [${data?.inetOrgPerson?.employeeType}:${data?.inetOrgPerson?.employeeNumber}]:&#x60;;
    try {
      this.logger.log(&#x60;${logPrefix} Starting additionalFields validation.&#x60;);
      const validations &#x3D; await this._validation.validate(data.additionalFields);
      this.logger.log(&#x60;${logPrefix} AdditionalFields validation successful.&#x60;);
      this.logger.log(&#x60;Validations : ${JSON.stringify(validations)}&#x60;);
      crushedUpdate[&#x27;state&#x27;] &#x3D; IdentityState.TO_VALIDATE;
    } catch (error) {
      data &#x3D; this.handleValidationError(error, data, logPrefix);
      crushedUpdate[&#x27;state&#x27;] &#x3D; data.state;
      crushedUpdate[&#x27;additionalFields.validations&#x27;] &#x3D; data.additionalFields.validations;
    }

    const fingerprint &#x3D; await this.previewFingerprint(
      construct({
        ...toPlainAndCrush(identity?.toJSON()),
        ...crushedUpdate,
      }),
    );
    await this.checkFingerprint(filters, fingerprint);

    const upserted &#x3D; await super.upsert(
      filters,
      {
        $setOnInsert: {
          ...crushedSetOnInsert,
          // &#x27;state&#x27;: IdentityState.TO_CREATE,
        },
        $set: {
          ...crushedUpdate,
          &#x27;additionalFields.objectClasses&#x27;: data.additionalFields.objectClasses,
          lastSync: new Date(),
        },
      },
      options,
    );

    return [
      identity ? HttpStatus.OK : HttpStatus.CREATED,
      await this.generateFingerprint(upserted as unknown as Identities, fingerprint),
    ];
  }

  public async update&lt;T extends AbstractSchema | Document&gt;(
    _id: Types.ObjectId | any,
    update: UpdateQuery&lt;T&gt;,
    options?: QueryOptions&lt;T&gt; &amp; { rawResult: true },
  ): Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt; {
    update &#x3D; this.transformNullsToString(update);
    // noinspection UnnecessaryLocalVariableJS
    //TODO : add validation logic here
    const logPrefix &#x3D; &#x60;Validation [${update.inetOrgPerson.cn}]:&#x60;;
    try {
      this.logger.log(&#x60;${logPrefix} Starting additionalFields validation.&#x60;);
      const validations &#x3D; await this._validation.validate(update.additionalFields);
      this.logger.log(&#x60;${logPrefix} AdditionalFields validation successful.&#x60;);
      this.logger.log(&#x60;Validations : ${validations}&#x60;);
    } catch (error) {
      if (error instanceof ValidationConfigException) {
        this.logger.error(&#x60;${logPrefix} Validation config error. ${JSON.stringify(error.getValidations())}&#x60;);
        throw new ValidationConfigException(error.getPayload());
      }
      if (error instanceof ValidationSchemaException) {
        this.logger.warn(&#x60;${logPrefix} Validation schema error. ${JSON.stringify(error.getValidations())}&#x60;);
        update.additionalFields.validations &#x3D; error.getValidations();
        throw new ValidationSchemaException(error.getPayload());
      } else {
        this.logger.error(&#x60;${logPrefix} Unhandled error: ${error.message}&#x60;);
        throw error; // Rethrow the original error if it&#x27;s not one of the handled types.
      }
    }

    // if (update.state &#x3D;&#x3D;&#x3D; IdentityState.TO_COMPLETE) {
    update &#x3D; { ...update, state: IdentityState.TO_VALIDATE };

    await this.checkInetOrgPersonJpegPhoto(update);

    // }
    // if (update.state &#x3D;&#x3D;&#x3D; IdentityState.SYNCED) {
    //   update &#x3D; { ...update, state: IdentityState.TO_VALIDATE };
    // }
    //update.state &#x3D; IdentityState.TO_VALIDATE;
    const updated &#x3D; await super.update(_id, update, options);
    //TODO: add backends service logic here (TO_SYNC)
    return await this.generateFingerprint(updated as unknown as Identities);
  }

  public async updateState&lt;T extends AbstractSchema | Document&gt;(
    _id: Types.ObjectId | any,
    state: IdentityState,
    options?: QueryOptions&lt;T&gt; &amp; { rawResult: true },
  ): Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt; {
    const updated &#x3D; await super.update(_id, { state }, options);
    return updated;
  }

  public async updateStateMany&lt;T extends AbstractSchema | Document&gt;(body: {
    ids: Types.ObjectId[];
    targetState: IdentityState;
    originState: IdentityState;
  }): Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;[]&gt; {
    const identities &#x3D; await this._model.find({ _id: { $in: body.ids } }).exec();
    if (identities.some((identity) &#x3D;&gt; identity.state !&#x3D;&#x3D; body.originState)) {
      throw new HttpException(&quot;Toutes les identités ne sont pas dans l&#x27;état attendu.&quot;, 400);
    }

    if (identities.length &#x3D;&#x3D;&#x3D; 0) {
      throw new HttpException(&#x27;Aucune identité trouvée.&#x27;, 404);
    }

    const updated &#x3D; await Promise.all(
      identities.map((identity) &#x3D;&gt; {
        return this.updateState(identity._id, body.targetState, { rawResult: true });
      }),
    );

    return updated as any;
  }

  public async delete&lt;T extends AbstractSchema | Document&gt;(
    _id: Types.ObjectId | any,
    options?: QueryOptions&lt;T&gt; | null | undefined,
  ): Promise&lt;Query&lt;T, T, any, T&gt;&gt; {
    // noinspection UnnecessaryLocalVariableJS
    //TODO: soft delete
    const deleted &#x3D; await super.delete(_id, options);
    //TODO: add backends service logic here (TO_SYNC)
    return deleted;
  }

  public async checkFingerprint&lt;T extends AbstractSchema | Document&gt;(
    filters: FilterQuery&lt;T&gt;,
    fingerprint: string,
  ): Promise&lt;void&gt; {
    const identity &#x3D; await this.model
      .findOne(
        { ...filters, fingerprint },
        {
          _id: 1,
        },
      )
      .exec();
    if (identity) {
      this.logger.debug(&#x60;Fingerprint matched for &lt;${identity._id}&gt; (${fingerprint}).&#x60;);
      this._model.findByIdAndUpdate(identity._id, { lastSync: new Date() }).exec();
      throw new HttpException(&#x27;Fingerprint matched.&#x27;, HttpStatus.NOT_MODIFIED);
    }
  }

  private async generateFingerprint&lt;T extends AbstractSchema | Document&gt;(
    identity: Identities,
    fingerprint?: string,
  ): Promise&lt;ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;&gt; {
    if (!fingerprint) {
      fingerprint &#x3D; await this.previewFingerprint(identity.toJSON());
    }

    const updated &#x3D; await this.model.findOneAndUpdate(
      { _id: identity._id, fingerprint: { $ne: fingerprint } },
      { fingerprint },
      {
        new: true,
      },
    );

    if (!updated) {
      this.logger.verbose(&#x60;Fingerprint already up to date for &lt;${identity._id}&gt;.&#x60;);
      return identity as unknown as ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;;
    }

    this.logger.debug(&#x60;Fingerprint updated for &lt;${identity._id}&gt;: ${fingerprint}&#x60;);
    return updated as unknown as ModifyResult&lt;Query&lt;T, T, any, T&gt;&gt;;
  }

  private async previewFingerprint(identity: any): Promise&lt;string&gt; {
    const additionalFields &#x3D; omit(identity.additionalFields, [&#x27;validations&#x27;]);
    const data &#x3D; JSON.stringify(
      construct(
        omit(
          toPlainAndCrush({
            inetOrgPerson: identity.inetOrgPerson,
            additionalFields,
          }) as any,
          [
            //TODO: add configurable fields to exclude
            /* &#x27;additionalFields.attributes.supannPerson.supannOIDCGenre&#x27; */
          ],
        ),
      ),
    );

    const hash &#x3D; createHash(&#x27;sha256&#x27;);
    hash.update(data);
    return hash.digest(&#x27;hex&#x27;).toString();
  }

  private handleValidationError(
    error: Error | HttpException,
    identity: Identities | IdentitiesUpsertDto,
    logPrefix: string,
  ): any {
    if (error instanceof ValidationConfigException) {
      this.logger.error(&#x60;${logPrefix} Validation config error. ${JSON.stringify(error.getValidations())}&#x60;);
      throw new ValidationConfigException(error.getPayload());
    }

    if (error instanceof ValidationSchemaException) {
      this.logger.warn(&#x60;${logPrefix} Validation schema error. ${JSON.stringify(error.getValidations())}&#x60;);
      identity.additionalFields.validations &#x3D; error.getValidations() as any;
      // console.log(&#x27;identity.state&#x27;, identity.state)
      if (identity.state &#x3D;&#x3D;&#x3D; IdentityState.TO_CREATE) {
        this.logger.warn(&#x60;${logPrefix} State set to TO_COMPLETE.&#x60;);
        identity.state &#x3D; IdentityState.TO_COMPLETE;
        return identity;
      } else {
        this.logger.error(&#x60;${logPrefix} Validation schema error. ${JSON.stringify(error.getValidations())}&#x60;);
        throw new ValidationSchemaException(error.getPayload());
      }
    } else {
      this.logger.error(&#x60;${logPrefix} Unhandled error: ${error.message}&#x60;);
      throw error; // Rethrow the original error if it&#x27;s not one of the handled types.
    }
  }

  private async checkInetOrgPersonJpegPhoto(data: any) {
    if (data?.inetOrgPerson?.jpegPhoto) {
      let reqStorage;
      const [disk, path] &#x3D; data.inetOrgPerson.jpegPhoto.split(&#x27;:&#x27;);

      try {
        reqStorage &#x3D; await this.storage.getDisk(disk).exists(path);
      } catch (error) {
        throw new BadRequestException(&#x60;Error while checking photo in storage: ${error.message}&#x60;);
      }

      if (!reqStorage.exists) {
        throw new BadRequestException(&#x60;Photo not found in storage: ${data.inetOrgPerson.jpegPhoto}&#x60;);
      }
    }
  }

  public transformNullsToString(obj) {
    if (obj &#x3D;&#x3D;&#x3D; null) {
      return &#x27;&#x27;;
    }

    if (Array.isArray(obj)) {
      return obj.map(this.transformNullsToString);
    }

    if (typeof obj &#x3D;&#x3D;&#x3D; &#x27;object&#x27; &amp;&amp; !(obj instanceof Types.ObjectId)) {
      for (const key in obj) {
        if (obj[key] &#x3D;&#x3D;&#x3D; null) {
          obj[key] &#x3D; &#x27;&#x27;;
        } else if (typeof obj[key] &#x3D;&#x3D;&#x3D; &#x27;object&#x27;) {
          console.log(&#x27;key&#x27;, key);
          obj[key] &#x3D; this.transformNullsToString(obj[key]);
        }
      }
    }

    return obj;
  }
  public async searchDoubles() {
    const agg1 &#x3D; [
      {
        $match: {
          state: { $ne: IdentityState.SYNCED },
          destFusionId: { $eq: null },
        },
      },
      {
        $addFields: {
          test: {
            $concat: [
              &#x27;$additionalFields.attributes.supannPerson.supannOIDCDatedeNaissance&#x27;,
              &#x27;$inetOrgPerson.givenName&#x27;,
            ],
          },
        },
      },
      {
        $group: {
          _id: &#x27;$test&#x27;,
          n: {
            $sum: 1,
          },
          list: {
            $addToSet: {
              _id: &#x27;$_id&#x27;,
              uid: &#x27;$inetOrgPerson.uid&#x27;,
              cn: &#x27;$inetOrgPerson.cn&#x27;,
              employeeNumber: &#x27;$inetOrgPerson.employeeNumber&#x27;,
              departmentNumber: &#x27;$inetOrgPerson.departmentNumber&#x27;,
            },
          },
        },
      },
      {
        $match: {
          n: {
            $gt: 1,
          },
        },
      },
    ];
    const agg2 &#x3D; [
      {
        $match: {
          state: { $ne: IdentityState.SYNCED },
          destFusionId: { $eq: null },
        },
      },
      {
        $group: {
          _id: &#x27;$inetOrgPerson.uid&#x27;,
          n: {
            $sum: 1,
          },
          list: {
            $addToSet: {
              _id: &#x27;$_id&#x27;,
              uid: &#x27;$inetOrgPerson.uid&#x27;,
              cn: &#x27;$inetOrgPerson.cn&#x27;,
              employeeNumber: &#x27;$inetOrgPerson.employeeNumber&#x27;,
              departmentNumber: &#x27;$inetOrgPerson.departmentNumber&#x27;,
            },
          },
        },
      },
      {
        $match: {
          n: {
            $gt: 1,
          },
        },
      },
    ];
    const result1 &#x3D; await this._model.aggregate(agg1);
    const result2 &#x3D; await this._model.aggregate(agg2);
    const result3 &#x3D; result1.map((x) &#x3D;&gt; {
      const k &#x3D; x.list[0]._id + &#x27;/&#x27; + x.list[1]._id;
      const k1 &#x3D; x.list[1]._id + &#x27;/&#x27; + x.list[0]._id;
      return { k1: k1, k: k, key1: x.list[0]._id, key2: x.list[1]._id, data: x.list };
    });
    const result4 &#x3D; result2.map((x) &#x3D;&gt; {
      const k &#x3D; x.list[0]._id + &#x27;/&#x27; + x.list[1]._id;
      const k1 &#x3D; x.list[1]._id + &#x27;/&#x27; + x.list[0]._id;
      return { k1: k1, k: k, key1: x.list[0]._id, key2: x.list[1]._id, data: x.list };
    });
    result4.forEach((x) &#x3D;&gt; {
      const r &#x3D; result3.find((o) &#x3D;&gt; o.k &#x3D;&#x3D;&#x3D; x.k);
      const r1 &#x3D; result3.find((o) &#x3D;&gt; o.k1 &#x3D;&#x3D;&#x3D; x.k);
      if (r &#x3D;&#x3D;&#x3D; undefined &amp;&amp; r1 &#x3D;&#x3D;&#x3D; undefined) {
        result3.push(x);
      }
    });
    return result3;
  }
  //fusionne les deux identités id2 &gt; id1 les champs presents dans id2 et non present dans id1 seront ajoutés
  // retourne l&#x27;id de na nouvelle identité créée
  public async fusion(id1, id2) {
    let identity1 &#x3D; null;
    let identity2 &#x3D; null;
    try {
      identity1 &#x3D; await this.findById(id1);
    } catch (error) {
      throw new BadRequestException(&#x27;Id1 not found&#x27;);
    }
    try {
      identity2 &#x3D; await this.findById(id2);
    } catch (error) {
      throw new BadRequestException(&#x27;Id2  not found&#x27;);
    }
    //test si une ou les  deux entités ont deja été fusionnées
    const x &#x3D; identity1.destFusionId
    if (identity1.destFusionId !&#x3D;&#x3D; undefined &amp;&amp; identity1.destFusionId !&#x3D;&#x3D; null) {
      throw new BadRequestException(&#x27;Id1  already fusionned&#x27;);
    }
    if (identity2.destFusionId !&#x3D;&#x3D; undefined &amp;&amp; identity2.destFusionId !&#x3D;&#x3D; null) {
      throw new BadRequestException(&#x27;Id2  already fusionned&#x27;);
    }
    const plainIdentity1 &#x3D; toPlainAndCrush(identity1.toJSON(), {
      excludePrefixes: [&#x27;_id&#x27;, &#x27;fingerprint&#x27;, &#x27;metadata&#x27;],
    });
    const plainIdentity2 &#x3D; toPlainAndCrush(identity2.toJSON(), {
      excludePrefixes: [&#x27;_id&#x27;, &#x27;fingerprint&#x27;, &#x27;metadata&#x27;],
    });
    const newObj: Partial&lt;Identities&gt; &#x3D; construct({ ...plainIdentity2, ...plainIdentity1 });
    //const newIdentity &#x3D; await this.create(newObj);
    newObj.inetOrgPerson.employeeType &#x3D; &#x27;FUSION&#x27;;
    newObj.inetOrgPerson.employeeNumber &#x3D;
      identity1.inetOrgPerson.employeeNumber + &#x27;/&#x27; + identity2.inetOrgPerson.employeeNumber;
    identity2.inetOrgPerson.departmentNumber.forEach((depN) &#x3D;&gt; {
      newObj.inetOrgPerson.departmentNumber.push(depN);
    });
    // si supann est present
    if (
      identity1.additionalFields.objectClasses.includes(&#x27;supannPerson&#x27;) &amp;&amp;
      identity2.additionalFields.objectClasses.includes(&#x27;supannPerson&#x27;)
    ) {
      identity2.additionalFields.attributes.supannPerson.supannTypeEntiteAffectation.forEach((depN) &#x3D;&gt; {
        newObj.additionalFields.attributes.supannPerson.supannTypeEntiteAffectation.push(depN);
      });
      // supannRefId
      identity2.additionalFields.attributes.supannPerson.supannRefId.forEach((depN) &#x3D;&gt; {
        newObj.additionalFields.attributes.supannPerson.supannRefId.push(depN);
      });
    }
    newObj.state &#x3D; IdentityState.TO_VALIDATE;
    newObj.srcFusionId &#x3D; [identity1._id, identity2._id];
    const newIdentity &#x3D; await this.create(newObj);
    //MAJ identite1
    identity1.destFusionId &#x3D; newIdentity._id;
    identity1.state &#x3D; IdentityState.DONT_SYNC;
    // modification identité1
    super.update(identity1._id, identity1);
    //Maj Identity2
    identity2.destFusionId &#x3D; newIdentity._id;
    identity2.state &#x3D; IdentityState.DONT_SYNC;
    // modification identité1
    super.update(identity2._id, identity2);
    return newIdentity._id;
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'IdentitiesService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
